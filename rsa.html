<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡∏™‡πà‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Å‡∏π‡πâ‡∏†‡∏±‡∏¢ ‚Äì ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ!</title>
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body,html{height:100%;font-family:'Sarabun',sans-serif;background:#000;color:#fff;overflow:hidden}
        .box{
            height:100vh;display:flex;flex-direction:column;justify-content:space-between;
            padding:20px;background:linear-gradient(135deg,#000,#0d0d0d);
        }
        .logo{font-size:90px;text-align:center;margin-top:30px;animation:float 3s infinite}
        @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-15px)}}
        h1{font-size:1.8rem;text-align:center;margin:10px 0 5px;font-weight:800}
        .desc{font-size:1.1rem;text-align:center;opacity:0.8}
        .main{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:30px}
        .status{
            padding:20px;border-radius:18px;background:rgba(255,255,255,0.1);
            text-align:center;font-size:1.3rem;width:90%;max-width:420px;
            backdrop-filter:blur(10px);border:2px solid transparent;
        }
        .status.ok{border-color:#27ae60;background:rgba(39,174,96,0.2)}
        .status.no{border-color:#e74c3c;background:rgba(231,76,60,0.2)}
        .btn{
            width:90%;max-width:420px;padding:24px;font-size:1.6rem;font-weight:800;
            border:none;border-radius:20px;color:#fff;cursor:pointer;
            box-shadow:0 12px 30px rgba(0,0,0,0.7);transition:0.3s;
        }
        .btn:active{transform:scale(0.95)}
        .start{background:#27ae60}
        .stop{background:#e74c3c;display:none}
        .team{position:fixed;top:10px;right:10px;background:rgba(0,0,0,0.7);padding:8px 16px;border-radius:12px;font-size:0.9rem}
        .debug{margin-top:10px;font-size:0.8rem;color:#aaa}
    </style>
</head>
<body>

<div class="team" id="team">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>

<div class="box">
    <div>
        <div class="logo">üö§</div>
        <h1>‡∏™‡πà‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå</h1>
        <div class="desc">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏µ‡∏°‡∏Å‡∏π‡πâ‡∏†‡∏±‡∏¢ ‚Äì ‡πÄ‡∏õ‡∏¥‡∏î‡∏ó‡∏¥‡πâ‡∏á‡πÑ‡∏ß‡πâ‡∏ï‡∏•‡∏≠‡∏î</div>
    </div>

    <div class="main">
        <div class="status" id="msg">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πà‡∏á (‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ!)</div>
        <button class="btn start" id="start">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πà‡∏á GPS</button>
        <button class="btn stop" id="stop">‡∏´‡∏¢‡∏∏‡∏î‡∏™‡πà‡∏á</button>
    </div>

    <div style="text-align:center;padding-bottom:20px;opacity:0.6;font-size:0.9rem">
        Flood Rescue 2025 ‚Ä¢ Public DB Active
    </div>
</div>

<script>
    // ‡πÅ‡∏Å‡πâ‡πÅ‡∏Ñ‡πà‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ 4 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î (TEAM_ID ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ô!)
    const TEAM_ID   = "boat_test_01";        // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô boat01, car02 ‡∏Ø‡∏•‡∏Ø (‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥)
    const TEAM_NAME = "‡πÄ‡∏£‡∏∑‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö 01";       // ‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°
    const VEHICLE   = "‡πÄ‡∏£‡∏∑‡∏≠";                // ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏¢‡∏≤‡∏ô‡∏û‡∏≤‡∏´‡∏ô‡∏∞
    const PHONE     = "081-000-0000";        // ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ (optional)

    // ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î public ‡∏à‡∏£‡∏¥‡∏á (‡πÑ‡∏°‡πà‡∏°‡∏µ permission denied)
    const DB_URL = "https://rescue-th-flood-2025-default-rtdb.asia-southeast1.firebasedatabase.app/rescue_teams";

    document.getElementById('team').textContent = `‡∏ó‡∏µ‡∏°: ${TEAM_ID}`;

    const msg = document.getElementById('msg');
    const startBtn = document.getElementById('start');
    const stopBtn = document.getElementById('stop');
    let watch = null;
    let debug = document.createElement('div'); debug.className = 'debug'; msg.appendChild(debug);

    function setMsg(text, ok = false) {
        msg.innerHTML = text + '<div class="debug"></div>';
        msg.className = 'status ' + (ok ? 'ok' : 'no');
    }

    async function send(pos) {
        const data = {
            name: TEAM_NAME,
            vehicle: VEHICLE,
            phone: PHONE || null,
            lat: pos.coords.latitude,
            lng: pos.coords.longitude,
            acc: Math.round(pos.coords.accuracy),
            speed: pos.coords.speed ? Math.round(pos.coords.speed * 3.6) : 0,
            time: new Date().toISOString(),
            active: true
        };

        try {
            const response = await fetch(`${DB_URL}/${TEAM_ID}.json`, {
                method: "PUT",
                body: JSON.stringify(data),
                headers: { 'Content-Type': 'application/json' }
            });
            if (response.ok) {
                setMsg(`‚úÖ ‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!<br>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á: ${data.lat.toFixed(4)}, ${data.lng.toFixed(4)}<br>‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥: ¬±${data.acc}‡∏°<br>‡πÄ‡∏ß‡∏•‡∏≤: ${new Date().toLocaleTimeString('th-TH')}`, true);
            } else {
                throw new Error(`HTTP ${response.status}`);
            }
        } catch (error) {
            setMsg(`‚ùå ‡∏™‡πà‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ: ${error.message}<br>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ô‡πá‡∏ï‡∏´‡∏£‡∏∑‡∏≠ GPS`, false);
        }
    }

    startBtn.onclick = async () => {
        if (!navigator.geolocation) return setMsg("‚ùå ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö GPS", false);

        setMsg("üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ç‡∏≠ GPS...", true);
        startBtn.style.display = "none";
        stopBtn.style.display = "block";

        // ‡∏™‡πà‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
        navigator.geolocation.getCurrentPosition(send, err => setMsg(`‚ùå GPS Error: ${err.message}`, false), {enableHighAccuracy: true});

        // ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á (‡∏ó‡∏∏‡∏Å 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
        watch = navigator.geolocation.watchPosition(send, err => setMsg(`‚ùå GPS ‡∏´‡∏¢‡∏∏‡∏î: ${err.message}`, false), { 
            enableHighAccuracy: true, 
            maximumAge: 5000, 
            timeout: 10000 
        });
    };

    stopBtn.onclick = async () => {
        if (watch) navigator.geolocation.clearWatch(watch);
        try {
            await fetch(`${DB_URL}/${TEAM_ID}/active.json`, {method:"PUT", body: JSON.stringify(false)});
        } catch {}
        setMsg("üõë ‡∏´‡∏¢‡∏∏‡∏î‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß", false);
        startBtn.style.display = "block";
        stopBtn.style.display = "none";
    };

    // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏î‡∏±‡∏ö
    let wakeLock = null;
    const keepAwake = async () => {
        if ('wakeLock' in navigator) {
            try { wakeLock = await navigator.wakeLock.request('screen'); } catch(e) {}
        }
    };
    document.addEventListener('visibilitychange', () => { if (!document.hidden) keepAwake(); });
    keepAwake();

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏´‡∏•‡∏±‡∏á 2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ (‡∏ñ‡πâ‡∏≤ GPS ‡∏û‡∏£‡πâ‡∏≠‡∏°)
    setTimeout(() => { if ('geolocation' in navigator) startBtn.click(); }, 2000);
</script>

</body>
</html>
