<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡∏Å‡∏π‡πâ‡∏†‡∏±‡∏¢ GPS ‚Äì ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏ñ‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà</title>
<style>
  body{font-family:sans-serif;background:#000;color:#fff;text-align:center;padding:40px;font-size:1.4rem}
  button{padding:20px 40px;margin:20px;font-size:1.8rem;border:none;border-radius:20px;background:#27ae60;color:#fff}
  .red{background:#e74c3c}
</style>
</head>
<body>
üö§ ‡∏ó‡∏µ‡∏°‡∏Å‡∏π‡πâ‡∏†‡∏±‡∏¢ ‚Äì ‡∏™‡πà‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå<br><br>
<button onclick="start()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πà‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á (‡∏Å‡∏î‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï!)</button><br>
<button class="red" onclick="reset()">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï GPS</button>
<div id="log" style="margin-top:30px"></div>

<script>
const TEAM_ID = "boat999"; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡∏°
const DB = "https://rescue-th-flood-2025-default-rtdb.asia-southeast1.firebasedatabase.app/rescue_teams";

function log(t){document.getElementById('log').innerHTML+=t+'<br>'}

function reset(){
  // ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ñ‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà
  if ('permissions' in navigator) {
    navigator.permissions.query({name:'geolocation'}).then(p=>{
      if(p.state==='denied'){
        alert('‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏Ñ‡∏¢‡∏ö‡∏•‡πá‡∏≠‡∏Å GPS ‡πÑ‡∏ß‡πâ\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÑ‡∏õ‡∏ó‡∏µ‡πà ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ > ‡πÑ‡∏ã‡∏ï‡πå > ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á > ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ rescue.karnhubs.com ‡πÉ‡∏´‡∏°‡πà');
      }
    });
  }
  location.reload();
}

function start(){
  if(!navigator.geolocation){log('‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö GPS');return}
  log('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ç‡∏≠‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‚Ä¶')
  navigator.geolocation.getCurrentPosition(pos=>{
    fetch(`${DB}/${TEAM_ID}.json`,{
      method:'PUT',
      body:JSON.stringify({
        name:"‡∏ó‡∏µ‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö 999",
        lat:pos.coords.latitude,
        lng:pos.coords.longitude,
        acc:Math.round(pos.coords.accuracy),
        time:new Date().toLocaleString('th-TH'),
        active:true
      })
    }).then(()=>log('‚úÖ ‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß!')).catch(()=>log('‚ùå ‡∏™‡πà‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ'))
  }, err=>{
    log('‚ùå '+err.message)
    if(err.code===1) alert('‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏î ‚Äú‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‚Äù ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏Ñ‡∏¢‡∏ö‡∏•‡πá‡∏≠‡∏Å‡πÑ‡∏ß‡πâ\n‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏î‡∏á‡∏Ç‡πâ‡∏≤‡∏á‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï')
  },{enableHighAccuracy:true})
}
</script>
</body>
</html>
